## 模式讲解

### 认识适配器模式

#### 1. 模式的功能

- 适配器模式的主要功能是「转换匹配」，目标是「复用已有的功能」，而不是实现新的接口。
- 也就是说，客户端需要的功能应该是「已经实现好了的」，「不需要」适配器模式来实现。
- 适配器模式主要负责把「不兼容的接口转换成客户端期望的样子」就可以了。

但这并不是说：在适配器里面就不能实现功能。适配器「可以实现功能」，称这种适配器为「智能适配器」。

再说了，在「接口匹配」和「转换」的过程中，也有「需要额外实现一些特定的功能」，才能够转换过来，比如需要调用参数以进行匹配等。

#### 2. Adaptee 和 Target 的关系

适配器模式中，被适配的接口 Adaptee 和 适配成为的接口 Target 是「没有关系的」，也就是说，Adaptee 和 Target 中的「方法既可以相同，也可以不同」。

极端情况下两个接口里面的方法可能是「完全不同」的，但也可以是「完全相同」的。

这里所说的「相同和不同」，是指方法定义的「名称、参数列表、返回值」，以及「本身的功能」都可以相同或不同。

#### 3. 对象组合

根据前面的实现，你会发现，适配器的实现方式其实是依靠「对象组合」的方式。

通过给适配器对象「组合被适配的对象」，然后当客户端调用 Target 的时候，适配器会把相应的功能「委托给被适配的对象去完成」。

#### 4. 适配器模式的调用顺序示意图

[P61]

评论：

- 适配器的主要功能是：转换匹配。
- 目的是：转换「已经实现」的功能，让客户端能够用「以前原来的方式」，调用到「被适配对象 (Adaptee)」。
- 这个客户端期望的方式 (以前的方式 Target)，原本就存在，而不是适配器 (Adapter) 新定义的。
- Adaptee 和 Target 是「没有关系」的，两个 interface 可以完全相同，可以完全不同。
- Adapter 的功能就是将 Adaptee 适配成 Target 接口的样子，实现「转换匹配」。

### 适配器模式的实现

#### 1. 适配器的常见实现

- 在实现适配器的时候，适配器通常是「一个类」，一般会让适配器类「去实现 Target 接口」，
- 然后在适配器的具体实现里面调用 Adaptee。
  - 也就是说适配器通常是一个 Target 类型，而不是 Adaptee 类型，如同前面例子演示的那样。

#### 2. 智能适配器

- 在实际开发中，适配器也可以实现一些「Adaptee 没有实现，但是在 Target 中定义的功能」。
- 这种情况就需要在适配器的实现里面，「加入新功能」的实现。

这种适配器被称为「智能适配器」。

- 如果要使用智能适配器，一般新加入功能的实现会用到很多 Adaptee 的功能，
- 「相当于利用 Adaptee 的功能来实现「更高层的」功能」。
- 当然也可以完全实现「新加入的功能」，和已有功能都不相关，变相地「扩展了功能」。

#### 3. 适配多个 Adaptee 「打星号」

适配器在适配的时候，可以适配多个 Adaptee，也就是说实现某个新的 Target 的功能的时候，可以调用多个模块的功能，适配多个模块的功能才能满足新接口的要求。

评论：

- 在 new Adapter() 的时候，传递的参数可以是多个 Adaptee，例如 new Adapter(adaptee1, adaptee2, adaptee3)，
- 然后在 Adapter 的实现代码里调用多个 adaptee，最后才能满足 Target 的要求。
- (注：这个 Adapter 的类型是 Target)


#### 4. 适配器 Adapter 实现的复杂程度

适配器 Adapter 实现的复杂程度取决于 Target 和 Adaptee 的相似程度。(Adapter 的目的本身就是实现「转换」嘛)

- 如果相似程度高：比如只有方法名称不一样，那么 Adapter 只需要「简单地转调一下」接口就可以了。
- 如果相似程度低：比如两边接口方法所定义的功能完全不一样，在 Target 中定义的一个方法，可能在 Adaptee 中定义了「三个更小的」方法，那么这个时候在实现 Adapter 的时候，就需要「组合调用」了。

评论：我觉得如果 Adaptee 通过 Adapter 转换成 Target，如果 Adapter 实现太复杂了，还不如直接重新写一个全新的 Adaptee 来得快。但 Adapter 本来的目的就是为了实现「复用」，对原本存在的 Adaptee 进行复用。

#### 5. 缺省适配 「打星号」

缺省适配的意思是：

- 为一个「接口」提供「缺省实现」。
- 有了它，就「不用直接去实现接口」，而是采用「继承」这个缺省适配对象，从而让子类可以「有选择地」去「覆盖实现」需要的方法，对于「不需要的方法」，使用「缺省适配」的方法就可以了。

[P62]

评论：感觉有点抽象，得看看具体代码。

### 双向适配器

适配器也可以实现双向的适配，前面我们讲的都是把 Adaptee 适配成为 Target，其实也可以把 Target 适配成为 Adaptee。

也就是说：这个适配器可以「同时当作 Target 和 Adaptee 来使用」。

